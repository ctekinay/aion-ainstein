# =============================================================================
# AION-AINSTEIN Routing Policy
# =============================================================================
# Centralized runtime configuration for routing behavior.
# All flags can be overridden via environment variables (AINSTEIN_ prefix)
# or via the Settings > Routing UI.
#
# ┌─────────────────────────────────────────────────────────────┐
# │  ROUTING MODE (choose one)                                  │
# │                                                             │
# │  strict_mode_enabled: true     (keyword routing)            │
# │    ├── catalog_short_circuit   (list/count bypass tree)     │
# │    │   └── list_route_requires_list_intent                  │
# │    └── [deterministic routes fire for meta, approval,       │
# │         DAR, content, compare, definitional, terminology,   │
# │         cross-domain, out-of-scope]                         │
# │                                                             │
# │  strict_mode_enabled: false    (LLM routing)                │
# │    ├── intent_router_enabled   (auto-set to true)           │
# │    ├── intent_router_mode      (heuristic | llm)            │
# │    └── intent_confidence_threshold                          │
# │                                                             │
# │  INDEPENDENT (always active)                                │
# │    ├── tree_enabled                                         │
# │    ├── abstain_gate_enabled                                 │
# │    ├── followup_binding_enabled                             │
# │    ├── max_tree_seconds                                     │
# │    └── debug_headers_enabled                                │
# └─────────────────────────────────────────────────────────────┘
# =============================================================================

# ---- Master Mode Switch ----

# Strict mode: when true, keyword-triggered deterministic routes fire
# (list detection, approval detection, scope gating, etc.).
# When false, all queries go through intent router → Elysia Tree path.
strict_mode_enabled: true

# ---- Intent Router (active when strict_mode_enabled is false) ----

# Intent router: when true, classify_intent() runs BEFORE routing.
# Automatically enabled when strict_mode_enabled is false.
intent_router_enabled: false

# Intent router implementation: "heuristic" (fast, regex) or "llm" (uses LLM)
intent_router_mode: heuristic

# Confidence threshold below which the router asks a clarifying question
intent_confidence_threshold: 0.55

# ---- Strict Mode Sub-Options ----

# Catalog short-circuit: deterministic list/count routes bypass Elysia Tree.
# Only effective when strict_mode_enabled is true.
catalog_short_circuit_enabled: true

# List route requires list intent: only trigger list tools when the intent
# classifier confirms list intent (prevents "What is an ADR?" → list).
# Only effective when catalog_short_circuit_enabled is true.
list_route_requires_list_intent: true

# ---- Independent Options ----

# Follow-up binding: resolve "list them" → "list dars" from conversation context
followup_binding_enabled: true

# Enable/disable Elysia Tree entirely. When false, all queries use
# direct retrieval + LLM generation (useful for "bare LLM + retrieval" experiments)
tree_enabled: true

# Maximum seconds before Elysia Tree times out and falls back to direct query
max_tree_seconds: 120

# Abstain gate: reject answers when retrieval quality is poor
abstain_gate_enabled: true

# Append routing debug footer to web UI responses (dev only)
debug_headers_enabled: false
